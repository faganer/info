<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="知名的图库网站及充满活力的创意社区，拥有上百万张免费正版高清图片素材，涵盖照片、插画、矢量图、视频等分类，你可以在任何地方使用图库中的素材，无惧版权风险。">
  <title>免费正版高清图片素材库 超过1百万张优质图片和视频素材可供免费使用和下载</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css">
  <link rel="stylesheet/less" href="style.scss">
  <script src="//cdn.jsdelivr.net/npm/less"></script>
</head>

<body>
  <div class="site">
    <div class="head">
      <img src="logo.svg" alt="">
    </div>
    <!-- .head -->

    <div class="filter">
      <div class="filter-title">类别：</div>
      <div class="category">
        <button data-type="nature" class="current">自然</button>
        <button data-type="backgrounds">背景</button>
        <button data-type="travel">旅行</button>
        <button data-type="places">地方</button>
        <button data-type="buildings">建筑物</button>
        <button data-type="science">科学</button>
        <button data-type="education">教育</button>
        <button data-type="people">人</button>
        <button data-type="feelings">感情</button>
        <button data-type="religion">宗教</button>
        <button data-type="health">健康</button>
        <button data-type="animals">动物</button>
        <button data-type="industry">行业</button>
        <button data-type="food">食品</button>
        <button data-type="computer">计算机</button>
        <button data-type="sports">体育</button>
        <button data-type="transportation">交通</button>
        <button data-type="business">商业</button>
        <button data-type="music">音乐</button>
        <button data-type="fashion">时尚</button>
      </div>
    </div>
    <!-- .filter -->

    <div class="search">
      <input type="text" class="search-text" placeholder="输入关键词"><button class="search-btn">搜索</button>
    </div>
    <!-- .search -->

    <div class="images"></div>
    <!-- .images -->

    <div class="pagenavi"><a class="prev" href="javascript:;">上一页</a><a class="next" href="javascript:;">下一页</a>
    </div>
    <!-- .pagenavi -->

  </div>
  <!-- .site -->

  <p>返回首页：<a href="https://getkit.cn/">鸽听网</a></p>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/combine/npm/sweetalert2@9,npm/js-cookie@2.2.0">
  </script>
  <script src="../assets/js/aliyun.js"></script>
  <script>
    $(function () {

      // 请求函数
      function getImages(category, page, q) {
        // https://pixabay.com/api/docs/
        var API_KEY = '6794696-982ef10d22faf303baa3dcd4f';
        var per_page = 40;
        var URL = "https://pixabay.com/api/?key=" + API_KEY + "&image_type=photo" +
          "&category=" + category + "&q=" + encodeURIComponent(q) + "&page=" + page + "&per_page=" + per_page +
          "&min_width=1280&lang=zh";
        Swal.fire({
          title: false,
          text: '数据加载中……',
          showCloseButton: false,
          showCancelButton: false,
          showconfirmButton: false,
          onBeforeOpen: () => {
            Swal.showLoading()
            $.getJSON(URL, function (data) {
              if (parseInt(data.totalHits) > 0) {
                var html = "";
                $.each(data.hits, function (i, hit) {
                  // 缩图
                  var thumbnail = hit.previewURL;
                  // 640px
                  var img640 = hit.previewURL.replace("_150", "_640");
                  // 1280px
                  var img1280 = hit.previewURL.replace("_150", "_1280");
                  // 标签
                  var tags = hit.tags;
                  // console
                  // console.log(hit.largeImageURL + hit.imageURL + hit.fullHDURL);
                  // 构建html
                  html += "<div class='image-item'><img data-img-full=" + img1280 +
                    " data-img-middle=" + img640 + " src=" + hit.previewURL +
                    "><p>" + tags + "</p></div>";
                });
                $(".images").append(html);

                Swal.close();

                // lightbox
                $(".image-item img").click(function () {
                  var imgMiddle = $(this).attr("data-img-middle");
                  var imgLarge = $(this).attr("data-img-full");
                  var tags = $(this).siblings("p").text();
                  Swal.fire({
                    title: false,
                    imageUrl: imgMiddle,
                    html: tags + '，<a href="' + imgLarge + '" target="_blank">下载 1280 图片</a>',
                    showCloseButton: false,
                    showCancelButton: false,
                    focusConfirm: false,
                    confirmButtonText: '关闭',
                  })
                });

                // 分页
                if (Math.ceil(data.total / per_page) > 1) {
                  // console.log(parseInt(page) + 1 < Math.ceil(data.total / per_page));
                  if (parseInt(page) + 1 < Math.ceil(data.total / per_page)) {
                    $(".pagenavi .next").attr("data-num", parseInt(page) + 1).addClass(
                      "show");
                  } else {
                    $(".pagenavi .next").removeAttr("data-num").removeClass("show");
                  }
                  if (parseInt(page) - 1 > 0) {
                    $(".pagenavi .prev").attr("data-num", parseInt(page) - 1).addClass(
                      "show");
                  } else {
                    $(".pagenavi .prev").removeAttr("data-num").removeClass("show");
                  }

                }
                // console.log(pageNumber);

              } else
                console.log('No hits');
            });
          }
        });

      }

      // 进入页面
      var category = $(".category .current").attr("data-type");
      localStorage.setItem("category", category);
      category = localStorage.getItem("category");
      var page = '1';
      localStorage.setItem("page", page);
      page = localStorage.getItem("page");
      getImages(category, page, '');


      // 选择分类
      $(".category button").click(function () {
        // 清空搜索
        $(".search-text").val("");
        $(this).addClass("current").siblings().removeClass("current");
        var category = $(this).attr("data-type");
        localStorage.setItem("category", category);
        category = localStorage.getItem("category");
        var page = '1';
        localStorage.setItem("page", page);
        page = localStorage.getItem("page");
        $(".images").empty();
        getImages(category, page, '');
      });

      // 下一页
      $(".pagenavi .next").click(function () {
        category = localStorage.getItem("category");
        // page = localStorage.getItem("page");
        var currentPage = $(this).attr("data-num");
        $(".images").empty();
        getImages(category, currentPage, '');
      });

      // 上一页
      $(".pagenavi .prev").click(function () {
        category = localStorage.getItem("category");
        // page = localStorage.getItem("page");
        var currentPage = $(this).attr("data-num");
        $(".images").empty();
        getImages(category, currentPage, '');
      });

      // 搜索
      $(".search").bind("keydown", function (e) {
        // 兼容FF和IE和Opera
        var theEvent = e || window.event;
        var code = theEvent.keyCode || theEvent.which || theEvent.charCode;
        if (code == 13) {
          $(".search-btn").click();
        }
      });

      //回车执行查询
      $(".search-btn").click(function () {
        // 判断输入框是否为空
        var inputVal = $(".search-text").val();
        if (inputVal) {
          // 获取分类
          var category = $(".category .current").attr("data-type");
          $(".images").empty();
          getImages(category, '1', inputVal);
          // 下一页
          $(".pagenavi .next").click(function () {
            category = localStorage.getItem("category");
            var currentPage = $(this).attr("data-num");
            $(".images").empty();
            getImages(category, currentPage, inputVal);
          });

          // 上一页
          $(".pagenavi .prev").click(function () {
            category = localStorage.getItem("category");
            // page = localStorage.getItem("page");
            var currentPage = $(this).attr("data-num");
            $(".images").empty();
            getImages(category, currentPage, inputVal);
          });
        } else {
          Swal.fire({
            icon: 'info',
            title: false,
            text: '请输入搜索内容！',
            width: 300,
            showCloseButton: false,
            showCancelButton: false,
            focusConfirm: false,
            confirmButtonText: '确定',
          })
        }
      });

    });
  </script>
  <script>
    // 百度统计
    var _hmt = _hmt || [];
    (function () {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?d03c6aa8bd7c946819fe6912a648b1c5";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();

    // 百度自动推送
    (function () {
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      } else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();

		// 360自动收录
		(function(){
		var src = "https://s.ssl.qhres2.com/ssl/ab77b6ea7f3fbf79.js";
		document.write('<script src="' + src + '" id="sozz"><\/script>');
		})();
  </script>
</body>

</html>
